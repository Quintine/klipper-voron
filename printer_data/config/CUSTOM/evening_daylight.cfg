[gcode_macro EVENING_DAYLIGHT]
description: Fade in daylight between 4:30pm and 6:00pm
gcode:
    {% set hour = now().hour %}
    {% set minute = now().minute %}
    {% set total_minutes = hour * 60 + minute %}
    {% set fade_start = 16 * 60 + 30 %}
    {% set fade_end = 18 * 60 %}

    {% if total_minutes < fade_start %}
        SET_PIN PIN=daylight VALUE=0
        RESPOND MSG="ðŸŒ‘ Daylight: OFF (before 4:30pm)"
    {% elif total_minutes >= fade_end %}
        SET_PIN PIN=daylight VALUE=1
        RESPOND MSG="ðŸŒ• Daylight: ON 100% (after 6pm)"
    {% else %}
        {% set progress = (total_minutes - fade_start) / (fade_end - fade_start) %}
        {% set brightness = progress %}
        SET_PIN PIN=daylight VALUE={{ brightness|round(3) }}

        {% set time_display = hour|string ~ ":" ~ ("%02d"|format(minute)) %}
        {% set fade_msg = "ðŸŒ— Daylight: " ~ (brightness * 100)|int|string ~ "% (" ~ time_display ~ ")" %}
        RESPOND MSG="{fade_msg}"
    {% endif %}